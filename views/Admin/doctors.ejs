<%- include("./partials/head.ejs") %>

<!-- Page Wrapper -->
<div id="wrapper">

    <%- include("./partials/sidebar.ejs") %>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <%- include("./partials/top-nav.ejs") %>

            <!-- Begin Page Content -->
            <div class="container-fluid">

                <!-- Page Heading -->
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Our Doctors</h6>
                    </div>

                    <div class="card-body">
                        <button class="btn btn-success mb-3" data-toggle="modal" data-target="#createDoctorModal">Create</button>
                        <div class="table-responsive">
                            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>Sl. No</th>
                                        <th>Doctor</th>
                                        <th>Department</th>
                                        <th>Image</th>
                                        <th>Qualifications</th>
                                        <th>Skills</th>
                                        <th>Appointment</th>
                                        <th>Action1</th>
                                        <th>Action2</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% let slNo = 1; %>
                                    <% if(doctors.length > 0) { %>
                                    <% doctors.forEach(doctor => { %>
                                    <tr>
                                        <td><%= slNo++ %></td>
                                        <td><%= doctor.name %></td>
                                        <td><%= doctor.department.department %></td>
                                        <td><img src="/<%= doctor.image %>" alt="" height="70"></td>
                                        <td>
                                            <% doctor.qualifications.forEach(qualification => { %>
                                                <p><strong><%= qualification.title %> - <%= qualification.year %></strong><br><%= qualification.description %></p>
                                            <% }) %>
                                        </td>
                                        <td>
                                            <p><%= doctor.skills.description %></p>
                                            <ul>
                                                <% doctor.skills.expertise.forEach(skill => { %>
                                                    <li><%= skill %></li>
                                                <% }) %>
                                            </ul>
                                        </td>
                                        <td>
                                            <p><strong>Monday to Friday:</strong> <%= doctor.appointment.mondayToFriday %></p>
                                            <p><strong>Saturday:</strong> <%= doctor.appointment.saturday %></p>
                                            <p><strong>Sunday:</strong> <%= doctor.appointment.sunday %></p>
                                            <p><strong>Contact Number:</strong> <%= doctor.appointment.contactNumber %></p>
                                        </td>
                                        <td>
                                            <button class="btn btn-primary" data-toggle="modal"
                                                data-target="#editDoctorModal<%= doctor._id %>">Edit</button>
                                        </td>
                                        <td>
                                            <button class="btn btn-danger" data-toggle="modal"
                                                data-target="#deleteDoctorModal<%= doctor._id %>">Delete</button>
                                        </td>
                                    </tr>
                                    <% }) %>
                                    <% } else { %>
                                    <tr>
                                        <td colspan="9">No Data Found</td>
                                    </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
            <!-- End Begin Page Content -->
        </div>
        <!-- End of Main Content -->

        <%- include("./partials/footer.ejs") %>

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Create Doctor Modal -->
<div class="modal fade" id="createDoctorModal" tabindex="-1" role="dialog" aria-labelledby="createDoctorModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createDoctorModalLabel">Create Doctor</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form action="/admin/doctor/create" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="department">Department</label>
                        <select class="form-control" id="department" name="department" required>
                            <% departments.forEach(department => { %>
                                <option value="<%= department._id %>"><%= department.department %></option>
                            <% }) %>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="image">Image</label>
                        <input type="file" class="form-control-file" id="image" name="image" required>
                    </div>
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="qualifications">Qualifications</label>
                        <div id="qualifications">
                            <div class="qualification">
                                <input type="text" class="form-control mb-2" name="qualificationTitle[]" placeholder="Title" required>
                                <input type="text" class="form-control mb-2" name="qualificationYear[]" placeholder="Year" required>
                                <textarea class="form-control mb-2" name="qualificationDescription[]" rows="2" placeholder="Description" required></textarea>
                            </div>
                        </div>
                        <button type="button" class="btn btn-info btn-sm mb-2 add-qualification">Add Qualification</button>
                    </div>
                    <div class="form-group">
                        <label for="skillsDescription">Skills Description</label>
                        <textarea class="form-control" id="skillsDescription" name="skillsDescription" rows="2" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="expertise">Expertise</label>
                        <input type="text" class="form-control" id="expertise" name="expertise" placeholder="Expertise 1, Expertise 2, ..." required>
                    </div>
                    
                    <div class="form-group">
                        <label for="mondayToFriday">Monday to Friday Availability</label>
                        <input type="text" class="form-control" id="mondayToFriday" name="mondayToFriday" required>
                    </div>
                    <div class="form-group">
                        <label for="saturday">Saturday Availability</label>
                        <input type="text" class="form-control" id="saturday" name="saturday" required>
                    </div>
                    <div class="form-group">
                        <label for="sunday">Sunday Availability</label>
                        <input type="text" class="form-control" id="sunday" name="sunday" required>
                    </div>
                    <div class="form-group">
                        <label for="contactNumber">Contact Number</label>
                        <input type="text" class="form-control" id="contactNumber" name="contactNumber" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- End Create Doctor Modal -->

<!-- Edit Doctor Modals -->
<% doctors.forEach(doctor => { %>
<div class="modal fade" id="editDoctorModal<%= doctor._id %>" tabindex="-1" role="dialog" aria-labelledby="editDoctorModalLabel<%= doctor._id %>" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editDoctorModalLabel<%= doctor._id %>">Edit Doctor</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form action="/admin/doctor/edit/<%= doctor._id %>" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" class="form-control" id="name" name="name" value="<%= doctor.name %>" required>
                    </div>
                    <div class="form-group">
                        <label for="department">Department</label>
                        <select class="form-control" id="department" name="department" required>
                            <% departments.forEach(department => { %>
                                <option value="<%= department._id %>" <%= doctor.department.toString() === department._id.toString() ? 'selected' : '' %>><%= department.department %></option>
                            <% }) %>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="image">Image</label>
                        <input type="file" class="form-control-file" id="image" name="image">
                        <small class="form-text text-muted">Leave blank to keep the current image.</small>
                    </div>
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3" required><%= doctor.description %></textarea>
                    </div>
                    <div class="form-group">
                        <label for="qualifications">Qualifications</label>
                        <div id="qualificationsEdit<%= doctor._id %>">
                            <% doctor.qualifications.forEach((qualification, index) => { %>
                            <div class="qualification">
                                <input type="text" class="form-control mb-2" name="qualificationTitleEdit[<%= index %>]" value="<%= qualification.title %>" placeholder="Title" required>
                                <input type="text" class="form-control mb-2" name="qualificationYearEdit[<%= index %>]" value="<%= qualification.year %>" placeholder="Year" required>
                                <textarea class="form-control mb-2" name="qualificationDescriptionEdit[<%= index %>]" rows="2" placeholder="Description" required><%= qualification.description %></textarea>
                                <button type="button" class="btn btn-danger btn-sm mb-2 remove-qualification">Remove</button>
                            </div>
                            <% }) %>
                        </div>
                        <button type="button" class="btn btn-info btn-sm mb-2 add-qualification-edit" data-doctorid="<%= doctor._id %>">Add Qualification</button>
                    </div>
                    <div class="form-group">
                        <label for="skillsDescription">Skills Description</label>
                        <textarea class="form-control" id="skillsDescription" name="skillsDescription" rows="2" required><%= doctor.skills.description %></textarea>
                    </div>
                    <div class="form-group">
                        <label for="expertise">Expertise</label>
                        <input type="text" class="form-control" id="expertise" name="expertise" value="<%= doctor.skills.expertise.join(', ') %>" required>
                    </div>
                    <div class="form-group">
                        <label for="mondayToFriday">Monday to Friday Availability</label>
                        <input type="text" class="form-control" id="mondayToFriday" name="mondayToFriday" value="<%= doctor.appointment.mondayToFriday %>" required>
                    </div>
                    <div class="form-group">
                        <label for="saturday">Saturday Availability</label>
                        <input type="text" class="form-control" id="saturday" name="saturday" value="<%= doctor.appointment.saturday %>" required>
                    </div>
                    <div class="form-group">
                        <label for="sunday">Sunday Availability</label>
                        <input type="text" class="form-control" id="sunday" name="sunday" value="<%= doctor.appointment.sunday %>" required>
                    </div>
                    <div class="form-group">
                        <label for="contactNumber">Contact Number</label>
                        <input type="text" class="form-control" id="contactNumber" name="contactNumber" value="<%= doctor.appointment.contactNumber %>" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>
<% }) %>
<!-- End Edit Doctor Modals -->

<!-- Delete Doctor Modals -->
<% doctors.forEach(doctor => { %>
<div class="modal fade" id="deleteDoctorModal<%= doctor._id %>" tabindex="-1" role="dialog" aria-labelledby="deleteDoctorModalLabel<%= doctor._id %>" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteDoctorModalLabel<%= doctor._id %>">Delete Doctor</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form action="/admin/doctor/delete/<%= doctor._id %>" method="POST">
                <div class="modal-body">
                    <p>Are you sure you want to delete this doctor?</p>
                    <p><strong>Name:</strong> <%= doctor.name %></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>
<% }) %>
<!-- End Delete Doctor Modals -->

<script>
    // Add Qualification field dynamically in Create Doctor Modal
    $(document).ready(function () {
        let qualificationCount = 1;
        $('.add-qualification').click(function () {
            $('#qualifications').append(`
                <div class="qualification">
                    <input type="text" class="form-control mb-2" name="qualificationTitle[]" placeholder="Title" required>
                    <input type="text" class="form-control mb-2" name="qualificationYear[]" placeholder="Year" required>
                    <textarea class="form-control mb-2" name="qualificationDescription[]" rows="2" placeholder="Description" required></textarea>
                    <button type="button" class="btn btn-danger btn-sm mb-2 remove-qualification">Remove</button>
                </div>
            `);
            qualificationCount++;
        });

        // Remove dynamically added Qualification field
        $(document).on('click', '.remove-qualification', function () {
            $(this).closest('.qualification').remove();
            qualificationCount--;
        });

        // Add Qualification field dynamically in Edit Doctor Modal
        $('.add-qualification-edit').click(function () {
            const doctorId = $(this).data('doctorid');
            $(`#qualificationsEdit${doctorId}`).append(`
                <div class="qualification">
                    <input type="text" class="form-control mb-2" name="qualificationTitleEdit[${qualificationCount}]" placeholder="Title" required>
                    <input type="text" class="form-control mb-2" name="qualificationYearEdit[${qualificationCount}]" placeholder="Year" required>
                    <textarea class="form-control mb-2" name="qualificationDescriptionEdit[${qualificationCount}]" rows="2" placeholder="Description" required></textarea>
                    <button type="button" class="btn btn-danger btn-sm mb-2 remove-qualification">Remove</button>
                </div>
            `);
            qualificationCount++;
        });

        // Remove dynamically added Qualification field in Edit Doctor Modal
        $(document).on('click', '.remove-qualification', function () {
            $(this).closest('.qualification').remove();
            qualificationCount--;
        });

        // Add Expertise field dynamically in Edit Doctor Modal
        $('.add-expertise-edit').click(function () {
            const doctorId = $(this).data('doctorid');
            $(`#expertiseEdit${doctorId}`).append(`
                <input type="text" class="form-control mb-2" name="expertiseEdit[${expertiseCount}]" placeholder="Expertise" required>
            `);
            expertiseCount++;
        });
    });
</script>


<!-- DataTable -->
<script>
    $(document).ready(function() {
        $('#dataTable').DataTable();
    });
</script>

